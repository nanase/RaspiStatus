<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Nanase Raspi Status</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/bootstrap-theme.min.css" />
    <script type="text/javascript" src="js/jquery-2.2.3.min.js"></script>
    <script type="text/javascript" src="js/jquery.easing.1.3.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <style>
        body {
            background-color: #212121;
            margin-top: 2px;
        }

        .obox {
            color: white;
            text-shadow: 0 2px 2px rgba(0, 0, 0, .3);
            box-shadow: 0 1px 2px rgba(0, 0, 0, .2);
            border: solid 1px rgba(0, 0, 0, .5);
            padding: 1rem 0;
        }

        .obox-temp {
            background-color: #208b38;
            border: solid 1px #208b38;
            background: #208b38;
            background: -webkit-gradient(linear, left top, left bottom, from(#208b38), to(#186b2b));
        }

        .obox-hum {
            background-color: #2565b0;
            border: solid 1px #2565b0;
            background: #2565b0;
            background: -webkit-gradient(linear, left top, left bottom, from(#2565b0), to(#1e5390));
        }

        .obox-press {
            background-color: #da7135;
            border: solid 1px #da7135;
            background: #da7135;
            background: -webkit-gradient(linear, left top, left bottom, from(#da7135), to(#c1642f));
        }

        .obox-uptime,
        .obox-obtime {
            background-color: #454545;
            border: solid 1px #454545;
            background: #454545;
            background: -webkit-gradient(linear, left top, left bottom, from(#454545), to(#333333));
        }

        .display-big {
            font-size: 2.5rem;
            font-weight: bold;
        }

        .display-unit {
            font-size: 1rem;
        }

        .display-name {
            font-size: 1.0rem;
            display: block;
            margin-top: -0.5rem;
        }

        .bar {
            height: 2px;
            position: absolute;
            top: 0;
            left: 0;
        }

        .barbox {
            overflow: hidden;
            width: 100%;
        }

        .progressbar {
            position: absolute;
            width: 0%;
        }

        .progressbar.updatebar {
            background-color: rgb(78, 142, 255);
            box-shadow: 0 1px 2px rgba(78, 142, 255, .5);
            z-index: 10;
        }

        .progressbar.errorbar {
            background-color: rgb(255, 78, 78);
            box-shadow: 0 1px 2px rgba(255, 78, 78, .8);
            z-index: 11;
        }
    </style>
    <script>
        var json_path = 'http://nanase.cc/raspi/status/json/';

        function secondToTime(t) {
            var z = v => (v < 10 ? '0' : '') + v;
            var h = t / 3600 | 0;
            var m = t % 3600 / 60 | 0;
            var s = t % 60;
            return (h != 0) ? h + ":" + z(m) + ":" + z(s) :
                (m != 0) ? m + ":" + z(s) : s + " seconds";
        }

        function unixtimeToString(unixtime) {
            var d = new Date(unixtime * 1000);
            return d.getHours() + ':' + ('0' + d.getMinutes()).substr(-2) + ':' + ('0' + d.getSeconds()).substr(-2);
        }

        function round(value, precision = 0) {
            var d = Math.pow(10, precision);
            return Math.round((value + 0) * d) / d;
        }

        function wait_start() {
            $('.updatebar').animate({
                width: "100%"
            }, 60000, 'easeInExpo', load_json);
        }

        function load_json() {
            $.getJSON(json_path, function(json) {
                $('.updatebar')
                    .animate({
                        width: "0%"
                    }, 500, 'easeOutExpo');

                if (json.succeed) {
                    $('.obox-temp .display-big').text(round(json.temperature, 2));
                    $('.obox-hum .display-big').text(round(json.humidity, 2));
                    $('.obox-press .display-big').text(round(json.pressure, 1));
                    $('.obox-uptime .display-big').text(secondToTime(json.uptime | 0));
                    $('.obox-obtime .display-big').text(unixtimeToString(json.time | 0));
                }

                wait_start();
            }).fail(function() {
                $('.errorbar')
                    .animate({
                        width: "100%"
                    }, 250, 'linear')
                    .animate({
                        width: "0%"
                    }, 30000, 'linear', load_json)
            });
        }

        $(load_json);
    </script>
</head>

<body>
    <div class="bar barbox">
        <div class="bar progressbar updatebar"></div>
        <div class="bar progressbar errorbar"></div>
    </div>
    <div class="container">
        <div class="row row-eq-height text-center">
            <div class="obox obox-temp col-xs-4 col-sm-4">
                <span class="display-big">--</span>
                <span class="display-unit">â„ƒ</span>
                <span class="display-name">Temperature</span>
            </div>
            <div class="obox obox-hum col-xs-4 col-sm-4">
                <span class="display-big">--</span>
                <span class="display-unit">%</span>
                <span class="display-name">Humidity</span>
            </div>
            <div class="obox obox-press col-xs-4 col-sm-4">
                <span class="display-big">--</span>
                <span class="display-unit">hPa</span>
                <span class="display-name">Pressure</span>
            </div>
        </div>
        <div class="row row-eq-height text-center">
            <div class="obox obox-uptime col-xs-6 col-sm-6">
                <span class="display-big">--</span>
                <span class="display-name">Uptime</span>
            </div>
            <div class="obox obox-obtime col-xs-6 col-sm-6">
                <span class="display-big">--</span>
                <span class="display-name">Observation time</span>
            </div>
        </div>
    </div>
</body>

</html>
